[
  {
    "Id": "275895",
    "ThreadId": "80486",
    "Html": "<p>I have a DataGrid that's bound to a collection of items. One of the datagrid's columns is a template column, whose CellEditingTemplate is a ComboBox. That ComboBox's ItemsSource is bound to the same collection. Unfortunately, when I try to click on the cell to expand the combo box, I get an InvalidOperationException from DataGridColumn:BeingEdit, line 733, indicating that 'DeferRefresh' is not allowed during an AddNew or EditItem transaction. I'm trying to understand why this is happening and is there someway to avoid/workaround it.</p>\r\n<div style=\"color:Black;background-color:White\">\r\n<pre><div style=\"color:Black;background-color:White\"><pre><span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Window</span> \r\n    <span style=\"color:Red\">x:Class</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">DataGridTest.Window1</span><span style=\"color:Black\">&quot;</span>\r\n    <span style=\"color:Red\">xmlns</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span><span style=\"color:Black\">&quot;</span>\r\n    <span style=\"color:Red\">xmlns:x</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">http://schemas.microsoft.com/winfx/2006/xaml</span><span style=\"color:Black\">&quot;</span>\r\n    <span style=\"color:Red\">xmlns:Controls</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">clr-namespace:Microsoft.Windows.Controls;assembly=WPFToolkit</span><span style=\"color:Black\">&quot;</span>\r\n    <span style=\"color:Red\">Title</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Window1</span><span style=\"color:Black\">&quot;</span> \r\n    <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">300</span><span style=\"color:Black\">&quot;</span> \r\n    <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">300</span><span style=\"color:Black\">&quot;</span>\r\n    <span style=\"color:Red\">x:Name</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">window</span><span style=\"color:Black\">&quot;</span>\r\n    <span style=\"color:Blue\">&gt;</span>\r\n    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid.RowDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">RowDefinition</span> <span style=\"color:Red\">Height</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">/&gt;</span>     \r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid.RowDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Grid.ColumnDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ColumnDefinition</span> <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">/&gt;</span>\r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid.ColumnDefinitions</span><span style=\"color:Blue\">&gt;</span>\r\n        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGrid</span>\r\n            <span style=\"color:Red\">Grid.Row</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span>\r\n            <span style=\"color:Red\">Grid.Column</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">0</span><span style=\"color:Black\">&quot;</span>\r\n            <span style=\"color:Red\">AutoGenerateColumns</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">False</span><span style=\"color:Black\">&quot;</span>\r\n            <span style=\"color:Red\">ItemsSource</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding ElementName=window, Path=Sam.Bobs}</span><span style=\"color:Black\">&quot;</span>\r\n            <span style=\"color:Red\">SelectionMode</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Single</span><span style=\"color:Black\">&quot;</span>\r\n            <span style=\"color:Red\">SelectionUnit</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Cell</span><span style=\"color:Black\">&quot;</span>\r\n            <span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGrid.Columns</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTextColumn</span>\r\n                    <span style=\"color:Red\">Header</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Name</span><span style=\"color:Black\">&quot;</span>\r\n                    <span style=\"color:Red\">Binding</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding Name, Mode=TwoWay}</span><span style=\"color:Black\">&quot;</span>\r\n                    <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span>\r\n                    <span style=\"color:Blue\">/&gt;</span>\r\n                <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTemplateColumn</span>\r\n                    <span style=\"color:Red\">Header</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Parent Bob</span><span style=\"color:Black\">&quot;</span>\r\n                    <span style=\"color:Red\">Width</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">*</span><span style=\"color:Black\">&quot;</span>\r\n                    <span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTemplateColumn.CellTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">TextBlock</span> <span style=\"color:Red\">Text</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding ParentBob.Name}</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">/&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTemplateColumn.CellTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTemplateColumn.CellEditingTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                            <span style=\"color:Blue\">&lt;</span><span style=\"color:#A31515\">ComboBox</span>\r\n                                <span style=\"color:Red\">DisplayMemberPath</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">Name</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">ItemsSource</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding Parent.Bobs}</span><span style=\"color:Black\">&quot;</span>\r\n                                <span style=\"color:Red\">SelectedItem</span><span style=\"color:Blue\">=</span><span style=\"color:Black\">&quot;</span><span style=\"color:Blue\">{Binding ParentBob, Mode=TwoWay}</span><span style=\"color:Black\">&quot;</span></pre>\r\n<pre>                                <span style=\"color:Blue\">/&gt;</span>\r\n                        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">DataTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTemplateColumn.CellEditingTemplate</span><span style=\"color:Blue\">&gt;</span>\r\n                <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGridTemplateColumn</span><span style=\"color:Blue\">&gt;</span>\r\n            <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGrid.Columns</span><span style=\"color:Blue\">&gt;</span>  \r\n        <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Controls</span><span style=\"color:Blue\">:</span><span style=\"color:#A31515\">DataGrid</span><span style=\"color:Blue\">&gt;</span>      \r\n    <span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Grid</span><span style=\"color:Blue\">&gt;</span>\r\n<span style=\"color:Blue\">&lt;/</span><span style=\"color:#A31515\">Window</span><span style=\"color:Blue\">&gt;</span>\r\n</pre>\r\n</div>\r\n</pre>\r\n<pre><div style=\"color:Black;background-color:White\"><pre>    <span style=\"color:Blue\">public</span> <span style=\"color:Blue\">partial</span> <span style=\"color:Blue\">class</span> Window1 : Window\r\n    {\r\n        <span style=\"color:Blue\">public</span> Window1()\r\n        {\r\n            Sam = <span style=\"color:Blue\">new</span> Sam();\r\n            InitializeComponent();\r\n        }\r\n\r\n        <span style=\"color:Blue\">public</span> Sam Sam\r\n        {\r\n            <span style=\"color:Blue\">get</span>;\r\n            <span style=\"color:Blue\">private</span> <span style=\"color:Blue\">set</span>;\r\n        }\r\n    }\r\n\r\n    <span style=\"color:Blue\">public</span> <span style=\"color:Blue\">class</span> Sam\r\n    {\r\n        <span style=\"color:Blue\">public</span> Sam()\r\n        {\r\n            Bobs = <span style=\"color:Blue\">new</span> ObservableCollection&lt;Bob&gt;();\r\n            Bobs.Add(<span style=\"color:Blue\">new</span> Bob { Name = <span style=\"color:#A31515\">&quot;Bob1&quot;</span>, Parent = <span style=\"color:Blue\">this</span> });\r\n            Bobs.Add(<span style=\"color:Blue\">new</span> Bob { Name = <span style=\"color:#A31515\">&quot;Bob2&quot;</span>, Parent = <span style=\"color:Blue\">this</span> });\r\n            Bobs.Add(<span style=\"color:Blue\">new</span> Bob { Name = <span style=\"color:#A31515\">&quot;Bob3&quot;</span>, Parent = <span style=\"color:Blue\">this</span> });\r\n        }\r\n\r\n        <span style=\"color:Blue\">public</span> ObservableCollection&lt;Bob&gt; Bobs\r\n        {\r\n            <span style=\"color:Blue\">get</span>;\r\n            <span style=\"color:Blue\">private</span> <span style=\"color:Blue\">set</span>;\r\n        }\r\n    }\r\n\r\n    <span style=\"color:Blue\">public</span> <span style=\"color:Blue\">class</span> Bob\r\n    {\r\n        <span style=\"color:Blue\">public</span> <span style=\"color:Blue\">string</span> Name\r\n        {\r\n            <span style=\"color:Blue\">get</span>;\r\n            <span style=\"color:Blue\">set</span>;\r\n        }\r\n\r\n        <span style=\"color:Blue\">public</span> Bob ParentBob\r\n        {\r\n            <span style=\"color:Blue\">get</span>; \r\n            <span style=\"color:Blue\">set</span>;\r\n        }\r\n\r\n        <span style=\"color:Blue\">public</span> Sam Parent\r\n        {\r\n            <span style=\"color:Blue\">get</span>;\r\n            <span style=\"color:Blue\">set</span>;\r\n        }\r\n    }\r\n</pre>\r\n</div>\r\n</pre>\r\n<pre>Although my real code uses view models, the sample above is simpler. Any help would be appreciated.</pre>\r\n<pre>Thanks,</pre>\r\n<pre>-Craig</pre>\r\n</div>",
    "PostedDate": "2010-01-11T14:32:52.607-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]