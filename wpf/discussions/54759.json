[
  {
    "Id": "184652",
    "ThreadId": "54759",
    "Html": "Hi I think I've discovered a nifty bug with the DataGrid and the DataGridColumns.<br>\r\n<br>\r\nFirstly I extended the standard DataGrid to have some drag and drop behaviour and named it DragDropDataGrid. I'm also using Tomer's WPF persistent state code to remember the column widths. I was also using it to remember column order but thought this bug was caused by Tomer's code. It wasn't.<br>\r\n<br>\r\nI have the columns declared for my DataGrid in XAML like so:<br>\r\n<br>\r\n&lt;control:DragDropDataGrid.Columns&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dg:DataGridTextColumn SortDirection=&quot;Descending&quot; x:Name=&quot;date&quot; ElementState.UId=&quot;CallHistoryDateColumn&quot; ElementState.Mode=&quot;Persist&quot; Width=&quot;{PropertyState Default=Auto}&quot; Binding=&quot;{Binding Path=Info.TimeInitiated, Mode=OneWay}&quot; Header=&quot;Date&quot;/&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dg:DataGridTemplateColumn x:Name=&quot;status&quot; ElementState.UId=&quot;CallHistoryIconColumn&quot; ElementState.Mode=&quot;Persist&quot; Width=&quot;{PropertyState Default=Auto}&quot;&nbsp; Header=&quot;Status&quot; SortMemberPath=&quot;Info.Type&quot;&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dg:DataGridTemplateColumn.CellTemplate&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;DataTemplate&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;ContentControl x:Name=&quot;statusicon&quot; Width=&quot;{DynamicResource IconPresenceStatus_Med}&quot;&nbsp; Height=&quot;{DynamicResource IconPresenceStatus_Med}&quot; Template=&quot;{Binding Path=Info.Type, Converter={StaticResource CallTypeToIconConverter}}&quot; VerticalAlignment=&quot;Top&quot;/&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/DataTemplate&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dg:DataGridTemplateColumn.CellTemplate&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/dg:DataGridTemplateColumn&gt;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;dg:DataGridTextColumn x:Name=&quot;address&quot; ElementState.UId=&quot;CallHistoryAddressColumn&quot; ElementState.Mode=&quot;Persist&quot; Width=&quot;{PropertyState Default=Auto}&quot;&nbsp; Binding=&quot;{Binding Path=Info.Display, Mode=OneWay}&quot; Header=&quot;Address&quot;/&gt;<br>\r\n&lt;/control:DragDropDataGrid.Columns&gt;<br>\r\n<br>\r\nI have a Loaded event handler that changes the DisplayIndex to the last saved layout:<br>\r\n<br>\r\nprivate void HistoryDataGrid_Loaded(object sender, RoutedEventArgs e)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; foreach (DataGridColumn col in this.HistoryDataGrid.Columns)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; string head = (string)col.Header;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (!col.Width.IsStar)<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; col.Width = new DataGridLength(1.0, DataGridLengthUnitType.Star);<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (head.Equals(&quot;Status&quot;))<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; col.DisplayIndex = Properties.Settings.Default.HistoryStatusIndex;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (head.Equals(&quot;Date&quot;))<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; col.DisplayIndex = Properties.Settings.Default.HistoryDateIndex;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; if (head.Equals(&quot;Address&quot;))<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; col.DisplayIndex = Properties.Settings.Default.HistoryAddressIndex;<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }<br>\r\n<br>\r\nThe bug shows up when the saved order is the exact reverse of the XAML. <br>\r\nXAML has the columns declared, Date, Status, Address. If I restore the order to Address, Status, Date, the columns get all mashed up into one column only showing the header for address. In addition the Address header can still be dragged around as if the other columns were in fact there.<br>\r\n<br>\r\n<br>\r\n",
    "PostedDate": "2009-04-28T12:02:02.227-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "184696",
    "ThreadId": "54759",
    "Html": "This is a known bug. In the mean time, you can workaround the issue by doing the following:<br>\r\n<br>\r\n<span style=\"font-size:13px\">\r\n<p>Dispatcher.BeginInvoke(</p>\r\n</span>\r\n<p><span style=\"color:#2b91af;font-size:13px\">DispatcherPriority</span><span style=\"font-size:13px\">.Background, (</span><span style=\"color:#2b91af;font-size:13px\">DispatcherOperationCallback</span><span style=\"font-size:13px\">)</span><span style=\"color:#0000ff;font-size:13px\">delegate</span><span style=\"font-size:13px\">(</span><span style=\"color:#0000ff;font-size:13px\">object</span><span style=\"font-size:13px\"> args)\r\n<p>&nbsp;</p>\r\n<p>{</p>\r\n<p>&nbsp;</p>\r\n</span></p>\r\n<p><span style=\"color:#0000ff;font-size:13px\">// Assign the DisplayIndex here</span><span style=\"font-size:13px\">\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n</span></p>\r\n<p><span style=\"color:#0000ff;font-size:13px\">return</span><span style=\"font-size:13px\"> </span><span style=\"color:#0000ff;font-size:13px\">null</span><span style=\"font-size:13px\">;\r\n<p>&nbsp;</p>\r\n<p>}, </p>\r\n</span></p>\r\n<p><span style=\"color:#0000ff;font-size:13px\">null</span><span style=\"font-size:13px\">);\r\n<p>&nbsp;</p>\r\n</span></p>\r\n",
    "PostedDate": "2009-04-28T13:41:15.44-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "185116",
    "ThreadId": "54759",
    "Html": "Hi Ben,<br>\r\n<br>\r\nThanks for the code snippet. It works fine when my DataGrid is visible on app startup.&nbsp; I'm having problems though when the DataGrid is in a hidden state. I tried using your code on IsVisibleChanged and it didn't seem to have any effect. <br>\r\n",
    "PostedDate": "2009-04-29T10:57:35.393-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "267163",
    "ThreadId": "54759",
    "Html": "<p>Is there a timeline on a fix for this bug yet?</p>",
    "PostedDate": "2009-12-14T10:30:45.127-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "269111",
    "ThreadId": "54759",
    "Html": "<p>I am using the source code release of the Toolkit for the datagrid, so if anyone knows what needs to be changed I can apply a patch and be on my merry way.</p>",
    "PostedDate": "2009-12-18T14:53:12.733-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "269704",
    "ThreadId": "54759",
    "Html": "<p>My mistake. Updated the WPFToolkit source and the problem is solved.</p>",
    "PostedDate": "2009-12-21T14:00:38.243-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]