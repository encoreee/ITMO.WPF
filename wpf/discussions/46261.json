[
  {
    "Id": "154469",
    "ThreadId": "46261",
    "Html": "Hi,<br>\r\n<br>\r\nIf a DataGrid is created at runtime (this is a requirement for me),  A PrintVisual simply doen't print anything.  It turns out the the DesiredSize of the DataGrid is not refreshed when columns are added dynamically.  Please note that if the DataGrid is created in xaml and columns are added at runtime, the same exact code works!!!  Any help would be greatly appreciated.  Here is some sample code to reproduce the problem.<br>\r\n<span style=\"font-size:13px\">\r\n<p>&nbsp;</p>\r\n</span>\r\n<p><span style=\"font-size:13px;color:#2b91af\"><br>\r\nPrintDialog</span><span style=\"font-size:13px\"> printDlg = </span><span style=\"font-size:13px;color:#0000ff\">new</span><span style=\"font-size:13px\"> </span><span style=\"font-size:13px;color:#2b91af\">PrintDialog</span><span style=\"font-size:13px\">();<br>\r\n<span style=\"font-size:13px\"><span style=\"font-size:13px\"><span style=\"font-size:13px;color:#0000ff\">if</span><span style=\"font-size:13px\"> (printDlg.ShowDialog().GetValueOrDefault()) {\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n</span>\r\n<p><span style=\"font-size:13px\"><span style=\"color:#2b91af\"><span style=\"color:#008000\">  //commenting the following line and creating the grid in xaml makes the code work</span><br>\r\n  DataGrid</span> grdForPrinting = <span style=\"color:#0000ff\">new</span> <span style=\"color:#2b91af\">DataGrid</span>();<br>\r\n</span><span style=\"color:#008000\"><br>\r\n<span style=\"font-size:13px\">  //set up dummy grid columns<br>\r\n</span></span><span style=\"font-size:13px\"><span style=\"color:#0000ff\">  for</span> (<span style=\"color:#0000ff\">int</span> i = 0; i &lt; 5; i++) {<br>\r\n<span style=\"color:#2b91af\">    DataGridTextColumn</span> colDef = <span style=\"color:#0000ff\">new</span> <span style=\"color:#2b91af\">DataGridTextColumn</span>();<br>\r\n    colDef.Header = <span style=\"color:#a31515\">&quot;Header &quot;</span> + i;<br>\r\n    colDef.Width = 100;<br>\r\n    grdForPrinting.Columns.Add(colDef);<br>\r\n  }<br>\r\n</span><span style=\"font-size:13px\"><span style=\"color:#008000\">  //set up some dummy height<br>\r\n</span>  grdForPrinting.Height = 100;<br>\r\n<br>\r\n<span style=\"color:#008000\">  //center the grid and print (calls to Measure and Arrange are required before printing)</span></span><br>\r\n  grdForPrinting.Measure(</p>\r\n</span>\r\n<p><span style=\"font-size:13px;color:#0000ff\">new</span><span style=\"font-size:13px\"> </span><span style=\"font-size:13px;color:#2b91af\">Size</span><span style=\"font-size:13px\">(</span><span style=\"font-size:13px;color:#2b91af\">Double</span><span style=\"font-size:13px\">.PositiveInfinity, </span><span style=\"font-size:13px;color:#2b91af\">Double</span><span style=\"font-size:13px\">.PositiveInfinity));<br>\r\n</span><span style=\"font-size:13px;color:#2b91af\">  Size</span><span style=\"font-size:13px\"> sizeGrid = grdForPrinting.DesiredSize;  <span style=\"color:#008000\">//DesiredSize has a zero width here!!!!</span><br>\r\n</span><span style=\"font-size:13px;color:#2b91af\">  Point</span><span style=\"font-size:13px\"> pointGrid = </span><span style=\"font-size:13px;color:#0000ff\">new</span><span style=\"font-size:13px\"> </span><span style=\"font-size:13px;color:#2b91af\">Point</span><span style=\"font-size:13px\">((printDlg.PrintableAreaWidth - sizeGrid.Width) / 2, <br>\r\n                                                    (printDlg.PrintableAreaHeight - sizeGrid.Height) / 2);<br>\r\n  grdForPrinting.Arrange(</span><span style=\"font-size:13px;color:#0000ff\">new</span><span style=\"font-size:13px\"> </span><span style=\"font-size:13px;color:#2b91af\">Rect</span><span style=\"font-size:13px\">(pointGrid, sizeGrid));<br>\r\n  printDlg.PrintVisual(grdForPrinting, </span><span style=\"font-size:13px;color:#a31515\">&quot;Printing not working&quot;</span><span style=\"font-size:13px\">);<br>\r\n}<br>\r\n<p>&nbsp;</p>\r\n</span></p>\r\n</span></span></p>\r\n",
    "PostedDate": "2009-02-04T15:39:55.4-08:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]