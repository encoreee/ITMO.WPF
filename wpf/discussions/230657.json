[
  {
    "Id": "506329",
    "ThreadId": "230657",
    "Html": "<p>Hi,<br><br>I'm using RowValidationRules with a DataGrid as follow:</p>\r\n<p>MainWindow.xaml</p>\r\n<p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Window</span> <span style=\"color:red\">x:Class</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">TestDataGrid.MainWindow</span><span style=\"color:black\">&quot;</span>\r\n        <span style=\"color:red\">xmlns</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">http://schemas.microsoft.com/winfx/2006/xaml/presentation</span><span style=\"color:black\">&quot;</span>\r\n        <span style=\"color:red\">xmlns:x</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">http://schemas.microsoft.com/winfx/2006/xaml</span><span style=\"color:black\">&quot;</span>\r\n        <span style=\"color:red\">xmlns:local</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">clr-namespace:TestDataGrid</span><span style=\"color:black\">&quot;</span>\r\n        <span style=\"color:red\">Title</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Test DataGrid</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Height</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">300</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Width</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">500</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">x:Name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Me</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Window.Resources</span><span style=\"color:blue\">&gt;</span>\r\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Style</span> <span style=\"color:red\">x:Key</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">RowStyle</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">TargetType</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">DataGridRow</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n            <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">EventSetter</span> <span style=\"color:red\">Event</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Validation.Error</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Handler</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">OnValidationError</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\r\n            <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Style.Triggers</span><span style=\"color:blue\">&gt;</span>\r\n                <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Trigger</span> <span style=\"color:red\">Property</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Validation.HasError</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Value</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">True</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n                    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Setter</span> <span style=\"color:red\">Property</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">BorderThickness</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Value</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">1</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n                    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Setter</span> <span style=\"color:red\">Property</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">BorderBrush</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Value</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Red</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n                    &lt;Setter Property=&quot;ToolTip&quot; Value=&quot;{Binding RelativeSource={RelativeSource Self},\r\n                        Path=(Validation.Errors)[0].ErrorContent}&quot;/&gt;\r\n                <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">Trigger</span><span style=\"color:blue\">&gt;</span>\r\n            <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">Style.Triggers</span><span style=\"color:blue\">&gt;</span>\r\n        <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">Style</span><span style=\"color:blue\">&gt;</span>\r\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">Window.Resources</span><span style=\"color:blue\">&gt;</span>\r\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">Grid</span><span style=\"color:blue\">&gt;</span>\r\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGrid</span> <span style=\"color:red\">AutoGenerateColumns</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">False</span><span style=\"color:black\">&quot;</span>\r\n                  <span style=\"color:red\">ItemsSource</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">{Binding ElementName=Me, Path=Appointments}</span><span style=\"color:black\">&quot;</span>\r\n                  <span style=\"color:red\">RowStyle</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">{StaticResource RowStyle}</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\r\n            <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGrid.RowValidationRules</span><span style=\"color:blue\">&gt;</span>\r\n                <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">local</span><span style=\"color:blue\">:</span><span style=\"color:#a31515\">RowDataInfoValidationRule</span> <span style=\"color:red\">ValidationStep</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">UpdatedValue</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\r\n            <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">DataGrid.RowValidationRules</span><span style=\"color:blue\">&gt;</span>\r\n            <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGrid.Columns</span><span style=\"color:blue\">&gt;</span>\r\n                <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGridTextColumn</span> <span style=\"color:red\">Header</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Name</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Binding</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">{Binding Path=Name, NotifyOnValidationError=True}</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n                <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGridTextColumn</span> <span style=\"color:red\">Header</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Age</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Binding</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">{Binding Path=Age, NotifyOnValidationError=True}</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n                <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGridTextColumn</span> <span style=\"color:red\">Header</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">Start</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Binding</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">{Binding Path=StartTime, NotifyOnValidationError=True}</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n                <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">DataGridTextColumn</span> <span style=\"color:red\">Header</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">End</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">Binding</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">{Binding Path=EndTime, NotifyOnValidationError=True}</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\r\n            <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">DataGrid.Columns</span><span style=\"color:blue\">&gt;</span>\r\n        <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">DataGrid</span><span style=\"color:blue\">&gt;</span>\r\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">Grid</span><span style=\"color:blue\">&gt;</span>\r\n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">Window</span><span style=\"color:blue\">&gt;</span>\r\n</pre>\r\n</div>\r\n</p>\r\n<p>MainWindow.xaml.cs</p>\r\n<p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre><span style=\"color:blue\">public</span> <span style=\"color:blue\">partial</span> <span style=\"color:blue\">class</span> MainWindow\r\n{\r\n    <span style=\"color:blue\">public</span> ObservableCollection&lt;Appointment&gt; Appointments { <span style=\"color:blue\">get</span>; <span style=\"color:blue\">private</span> <span style=\"color:blue\">set</span>; }\r\n\r\n    <span style=\"color:blue\">public</span> MainWindow()\r\n    {\r\n        Appointments = <span style=\"color:blue\">new</span> ObservableCollection&lt;Appointment&gt;\r\n        {\r\n            <span style=\"color:blue\">new</span> Appointment { Name = <span style=\"color:#a31515\">&quot;John&quot;</span>, Age = 40, StartTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 1), EndTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 2) },\r\n            <span style=\"color:blue\">new</span> Appointment { Name = <span style=\"color:#a31515\">&quot;Mary&quot;</span>, Age = 30, StartTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 1), EndTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 2) },\r\n            <span style=\"color:blue\">new</span> Appointment { Name = <span style=\"color:#a31515\">&quot;Frank&quot;</span>, Age = 20, StartTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 1), EndTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 2) },\r\n            <span style=\"color:blue\">new</span> Appointment { Name = <span style=\"color:#a31515\">&quot;Jack&quot;</span>, Age = 10, StartTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 1), EndTime = <span style=\"color:blue\">new</span> DateTime(2010, 1, 2) }\r\n        };\r\n\r\n        InitializeComponent();\r\n    }\r\n\r\n    <span style=\"color:blue\">private</span> <span style=\"color:blue\">void</span> OnValidationError(<span style=\"color:blue\">object</span> sender, ValidationErrorEventArgs e)\r\n    {\r\n        Trace.WriteLine(<span style=\"color:#a31515\">&quot;OnValidationError has been called: &quot;</span> + e.Action);\r\n    }\r\n}\r\n</pre>\r\n</div>\r\n</p>\r\n<p>The problem is the OnValidationError event handler that is never being  called... Is there anything I'm doing wrong?</p>\r\n<p>I have done some  investigations to find that the NotifyOnValidationError property of the  BindingGroup used by the DataGrid (ItemsControl.ItemBindingGroup) is never set to true. This is the reason why the event handler is never being called. To fix it, I'm using the following workaround (not very clean but it works). I set it to True by code in the ValidationRule itself:</p>\r\n<p>\r\n<div style=\"color:black;background-color:white\">\r\n<pre><span style=\"color:blue\">public</span> <span style=\"color:blue\">class</span> RowDataInfoValidationRule : ValidationRule\r\n{\r\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">override</span> ValidationResult Validate(<span style=\"color:blue\">object</span> value, CultureInfo cultureInfo)\r\n    {\r\n        BindingGroup <span style=\"color:blue\">group</span> = (BindingGroup)value;\r\n        StringBuilder error = <span style=\"color:blue\">null</span>;\r\n\r\n        <span style=\"color:blue\">foreach</span> (<span style=\"color:blue\">var</span> item <span style=\"color:blue\">in</span> <span style=\"color:blue\">group</span>.Items)\r\n        {\r\n            <span style=\"color:green\">// aggregate errors</span>\r\n            IDataErrorInfo info = item <span style=\"color:blue\">as</span> IDataErrorInfo;\r\n            <span style=\"color:blue\">if</span> (info == <span style=\"color:blue\">null</span>)\r\n                <span style=\"color:blue\">continue</span>;\r\n\r\n            <span style=\"color:blue\">if</span> (<span style=\"color:blue\">string</span>.IsNullOrEmpty(info.Error))\r\n                <span style=\"color:blue\">continue</span>;\r\n\r\n            <span style=\"color:blue\">if</span> (error == <span style=\"color:blue\">null</span>)\r\n                error = <span style=\"color:blue\">new</span> StringBuilder();\r\n\r\n            <span style=\"color:#ff0000\">group.NotifyOnValidationError = true;\r\n</span>\r\n            error.Append((error.Length != 0 ? <span style=\"color:#a31515\">&quot;, &quot;</span> : <span style=\"color:#a31515\">&quot;&quot;</span>) + info.Error);\r\n        }\r\n\r\n        <span style=\"color:blue\">return</span> error == <span style=\"color:blue\">null</span> ? ValidationResult.ValidResult : <span style=\"color:blue\">new</span> ValidationResult(<span style=\"color:blue\">false</span>, error.ToString());\r\n    }\r\n}\r\n\r\n</pre>\r\n</div>\r\n</p>\r\n<p>How can I set the NotifyOnValidationError property to true in XAML? Is there any order way to make this work?<br><br>I can provide the full code of my test application if required.</p>\r\n<p>Thank you</p>",
    "PostedDate": "2010-10-12T17:08:03.59-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]