[
  {
    "Id": "196449",
    "ThreadId": "58103",
    "Html": "<p>hi,</p>\r\n<p>first off - thanks for the toolkit; to my mind the best datagrid product there is out there. i am having one little issue with it however, and i don't really understand it at all.</p>\r\n<p>background:</p>\r\n<p>I have a collection of objects, and they have a settable property &quot;Sequence&quot;. The collection is ordered via sequence. I have the requirement that the user be able to use drag &amp; drop to set the sequence. So my code on PreviewMouseMove effectively just checks that the mouse left button is pressed, and then shoves the datagrid's selected item into a dataobject and calls the DoDragDrop method.</p>\r\n<p>On drop - I get the data, find the row at the relevant position, and set the sequence of the dropped object to the row's index + 1 - then the underlying collection will sort out the other sequences (i.e. if i'm moving object 1 to sequence 5, then objects 2, 3, 4 and 5 need to decrement their own sequences to keep parity) and sort itself. This all works fine...</p>\r\n<p>... until! If I were to select a row, get into edit mode (doesn't have to change anything, as long as the text is selected), then move that row using the drag &amp; drop, then select another item - it all falls down!</p>\r\n<p>The row I just moved cannot be selected again - well, this isn't entirely true - it's never painted as being selected again, I can still drag and drop &amp; edit etc. When debugging, if I was to move it again, handling the drop event shows the SelectedItem as not being the same item as SelectedCells[0].Item - the two are different. SelectedItem is the one I'm expecting (as in the one I've just moved and will not be painted as selected), and the SelectedCells is the currently painted cells.</p>\r\n<p>This only happens to ONE item at a time - so if I am to perform a drag &amp; drop on a different item, without doing the selecting first - then everything goes back to normal. If I am to do the selection first and then try and move it - it is that item that can't be selected and the original is fine.</p>\r\n<p>I know this is weird, and is going to be difficult to offer any kind of solution since it's kind of specific circumstance - but this is really doing my head in! I can knock up a replica if required.</p>\r\n<p>ALSO - and this isn't so much specific to the datagrid... but on the handle mouse move event - I have to check the Keyboard.Focused element to see if it's a textbox - and if it is a textbox, ensure that there is no text selected - otherwise don't perform the Drag/Drop. The reason for this is - if I attempt to call DragDrop.DoDragDrop(blah) whilst the cell has a textbox with its text selected, I get a Dispatcher processing suspended exception. Any ideas why this is? Is this to do with the way the textbox handles the selected text event? I don't think it's specific to the grid since this occurs on other grids (as I was trying to fix that!). The only reason why I mention it - could (and I can't see how) this line of code actually affect what's going on?</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">&lt;font size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;&lt;font size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;\r\n<p>private</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font size=&quot;2&quot; color=&quot;#0000ff&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span>\r\n<p><span style=\"font-size:x-small\"> </span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">void</span></span><span style=\"font-size:x-small\"> ItemGridPreviewMouseMove(</span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">object</span></span><span style=\"font-size:x-small\"> sender, </span><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">MouseEventArgs</span></span><span style=\"font-size:x-small\"> e)\r\n<p>{</p>\r\n&lt;font size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">TextBox</span></span><span style=\"font-size:x-small\"> focused = </span><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">Keyboard</span></span><span style=\"font-size:x-small\">.FocusedElement </span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">as</span></span><span style=\"font-size:x-small\"> </span><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">TextBox</span></span><span style=\"font-size:x-small\">;&lt;font size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">if</span></span><span style=\"font-size:x-small\"> (focused != </span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">null</span></span><span style=\"font-size:x-small\"> &amp;&amp; (focused.SelectionStart != 0 || focused.SelectionLength &gt; 0))\r\n<p>{</p>\r\n&lt;font size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">return</span></span><span style=\"font-size:x-small\">;\r\n<p>}</p>\r\n&lt;font size=&quot;2&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">if</span></span><span style=\"font-size:x-small\"> (e.LeftButton == </span><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">MouseButtonState</span></span><span style=\"font-size:x-small\">.Pressed</span><span style=\"font-size:x-small\">) </span></p>\r\n<p>{</p>\r\n</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>&nbsp;</p>\r\n<p>\r\n<p><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">&lt;font size=&quot;2&quot; color=&quot;#2b91af&quot;&gt;&lt;font size=&quot;2&quot; color=&quot;#2b91af&quot;&gt;\r\n<p>DragDrop</p>\r\n&lt;/font&gt;&lt;/font&gt;</span>&lt;font size=&quot;2&quot; color=&quot;#2b91af&quot;&gt;\r\n<p>&nbsp;</p>\r\n&lt;/font&gt;</span>\r\n<p><span style=\"font-size:x-small\">.DoDragDrop(</span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">this</span></span><span style=\"font-size:x-small\">.itemGrid,</span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">new</span></span><span style=\"font-size:x-small\"> </span><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">DataObject</span></span><span style=\"font-size:x-small\">(format, </span><span style=\"font-size:x-small;color:#0000ff\"><span style=\"font-size:x-small;color:#0000ff\">this</span></span><span style=\"font-size:x-small\">.itemGrid.SelectedItem),</span><span style=\"font-size:x-small;color:#2b91af\"><span style=\"font-size:x-small;color:#2b91af\">DragDropEffects</span></span><span style=\"font-size:x-small\">.Move);</span></p>\r\n<p><span style=\"font-size:x-small\">}</span></p>\r\n<p><span style=\"font-size:x-small\">}</span></p>\r\n<p><span style=\"font-size:x-small\">Any suggestions / ideas / pointers would be extremely helpful - as I said, I'm tearing my hair out - the disparity between SelectedCells &amp; SelectedItem is completely weird and I can't see what could have caused it. Calling Items.RefreshItems() fixes it - but ONLY until the next processing happens (I tried calling it through the immediate window on the event handlers, and it does work, for about a nanosecond, before reverting back). </span></p>\r\n<p><span style=\"font-size:x-small\">Looking at the code, I can't see why the SelectedCells would be different - and ONLY after a selection has been done, and then a move attempt.</span></p>\r\n<p>&nbsp;</p>\r\n<p><span style=\"font-size:x-small\">Thanks for your time!</span></p>\r\n</p>\r\n</p>",
    "PostedDate": "2009-06-01T09:01:57.367-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]