{
  "WorkItem": {
    "AffectedComponent": {
      "Name": "",
      "DisplayName": ""
    },
    "ClosedComment": "",
    "ClosedDate": null,
    "CommentCount": 0,
    "Custom": null,
    "Description": "Hello,\n \nI have a DataGrid whose ItemsSource is bound to a property. Whenever I want to navigate to a different set of data, this property is updated (via the UI thread) and the data is reflected in the DataGrid. My DataGrid is defined as follows :\n \n<WPFToolkit:DataGrid x:Name=\"uxPortfolioExecutions\" Grid.Column=\"1\" ItemsSource=\"{Binding PortfolioExecutions}\" AutoGenerateColumns=\"True\" IsReadOnly=\"True\" CanUserResizeRows=\"False\" SelectionMode=\"Single\" EnableRowVirtualization=\"True\" VirtualizingStackPanel.IsVirtualizing=\"True\" VirtualizingStackPanel.VirtualizationMode=\"Standard\"  />\n \nand my property is defined as follows :\n \n\t\tprivate IList<PortfolioExecution> portfolioExecutions;\n\t\tpublic IList<PortfolioExecution> PortfolioExecutions\n\t\t\t{\n\t\t\tget\n\t\t\t\t{\n\t\t\t\treturn portfolioExecutions;\n\t\t\t\t}\n\t\t\tset\n\t\t\t\t{\n\t\t\t\tportfolioExecutions = value;\n\t\t\t\tportfolioExecutionsView = CollectionViewSource.GetDefaultView(portfolioExecutions);\n\t\t\t\tportfolioExecutionsView.Filter = PortfolioExecutionsViewFilter;\n\t\t\t\tnotifyPropertyChangedBehavior.RaisePropertyChanged(\"PortfolioExecutions\");\n\t\t\t\t}\n\t\t\t}\n \n I have a problem (which I can reproduce easily in a matter of seconds) where after navigating through a few sets of data, the app crashes with the following message:\n \nCollection was modified; enumeration operation may not execute.\n \n   at System.Collections.Hashtable.HashtableEnumerator.MoveNext()\n   at Microsoft.Windows.Controls.WeakHashtable.ScavengeKeys() in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\WeakHashtable.cs:line 101\n   at Microsoft.Windows.Controls.WeakHashtable.SetWeak(Object key, Object value) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\WeakHashtable.cs:line 54\n   at Microsoft.Windows.Controls.DataGridHelper.GetPropertyTransferEnabledMapForObject(DependencyObject d) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridHelper.cs:line 445\n   at Microsoft.Windows.Controls.DataGridHelper.TransferProperty(DependencyObject d, DependencyProperty p) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridHelper.cs:line 432\n   at Microsoft.Windows.Controls.DataGridCell.NotifyPropertyChanged(DependencyObject d, String propertyName, DependencyPropertyChangedEventArgs e, NotificationTarget target) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCell.cs:line 252\n   at Microsoft.Windows.Controls.DataGridCell.OnNotifyPropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCell.cs:line 210\n \nThis seems to happen with both relatively large sets of data (around 3000 rows) and small sets of data (20 rows) but only when row virtualization is enabled.\n \nRegards,\n \nAnthony",
    "LastUpdatedDate": "2013-02-21T18:41:18.4-08:00",
    "PlannedForRelease": "",
    "ReleaseVisibleToPublic": false,
    "Priority": {
      "Name": "Low",
      "Severity": 50,
      "Id": 1
    },
    "ProjectName": "wpf",
    "ReportedDate": "2009-04-29T08:56:09.74-07:00",
    "Status": {
      "Name": "Proposed",
      "Id": 1
    },
    "ReasonClosed": {
      "Name": "Unassigned"
    },
    "Summary": "WeakHashTable error when navigating through different data sources in DataGrid",
    "Type": {
      "Name": "Issue",
      "Id": 3
    },
    "VoteCount": 1,
    "Id": 9892
  },
  "FileAttachments": [],
  "Comments": [
    {
      "Message": "Sorry, forgot to include the full stack trace :\r\n\r\n   at System.Collections.Hashtable.HashtableEnumerator.MoveNext()\r\n   at Microsoft.Windows.Controls.WeakHashtable.ScavengeKeys() in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\WeakHashtable.cs:line 101\r\n   at Microsoft.Windows.Controls.WeakHashtable.SetWeak(Object key, Object value) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\WeakHashtable.cs:line 54\r\n   at Microsoft.Windows.Controls.DataGridHelper.GetPropertyTransferEnabledMapForObject(DependencyObject d) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridHelper.cs:line 445\r\n   at Microsoft.Windows.Controls.DataGridHelper.TransferProperty(DependencyObject d, DependencyProperty p) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridHelper.cs:line 432\r\n   at Microsoft.Windows.Controls.DataGridCell.NotifyPropertyChanged(DependencyObject d, String propertyName, DependencyPropertyChangedEventArgs e, NotificationTarget target) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCell.cs:line 252\r\n   at Microsoft.Windows.Controls.DataGridCell.OnNotifyPropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCell.cs:line 210\r\n   at System.Windows.PropertyChangedCallback.Invoke(DependencyObject d, DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.DependencyObject.OnPropertyChanged(DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.FrameworkElement.OnPropertyChanged(DependencyPropertyChangedEventArgs e)\r\n   at System.Windows.DependencyObject.NotifyPropertyChange(DependencyPropertyChangedEventArgs args)\r\n   at System.Windows.DependencyObject.UpdateEffectiveValue(EntryIndex entryIndex, DependencyProperty dp, PropertyMetadata metadata, EffectiveValueEntry oldEntry, EffectiveValueEntry& newEntry, Boolean coerceWithDeferredReference, OperationType operationType)\r\n   at System.Windows.DependencyObject.InvalidateProperty(DependencyProperty dp)\r\n   at System.Windows.FrameworkElement.UpdateStyleProperty()\r\n   at System.Windows.FrameworkElement.OnInitialized(EventArgs e)\r\n   at System.Windows.FrameworkElement.TryFireInitialized()\r\n   at System.Windows.FrameworkElement.OnVisualParentChanged(DependencyObject oldParent)\r\n   at System.Windows.Media.Visual.FireOnVisualParentChanged(DependencyObject oldParent)\r\n   at System.Windows.Media.Visual.AddVisualChild(Visual child)\r\n   at System.Windows.Media.VisualCollection.ConnectChild(Int32 index, Visual value)\r\n   at System.Windows.Media.VisualCollection.Add(Visual visual)\r\n   at System.Windows.Controls.UIElementCollection.AddInternal(UIElement element)\r\n   at System.Windows.Controls.VirtualizingPanel.AddInternalChild(UIElement child)\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.InsertContainer(Int32 childIndex, UIElement container, Boolean isRecycled) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 735\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.InsertNewContainer(Int32 childIndex, UIElement container) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 665\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.AddContainerFromGenerator(Int32 childIndex, UIElement child, Boolean newlyRealized) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 648\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.GenerateChild(IItemContainerGenerator generator, Size constraint, DataGridColumn column, Int32& childIndex, Size& childSize) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 560\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.GenerateChildren(IItemContainerGenerator generator, Int32 startIndex, Int32 endIndex, Size constraint) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 600\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.GenerateAndMeasureChildrenForRealizedColumns(Size constraint) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 176\r\n   at Microsoft.Windows.Controls.DataGridCellsPanel.MeasureOverride(Size constraint) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\DataGridCellsPanel.cs:line 76\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at MS.Internal.Helper.MeasureElementWithSingleChild(UIElement element, Size constraint)\r\n   at System.Windows.Controls.ItemsPresenter.MeasureOverride(Size constraint)\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at System.Windows.Controls.Control.MeasureOverride(Size constraint)\r\n   at Microsoft.Windows.Controls.Primitives.DataGridCellsPresenter.MeasureOverride(Size availableSize) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\Primitives\\DataGridCellsPresenter.cs:line 451\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at System.Windows.Controls.Grid.MeasureCell(Int32 cell, Boolean forceInfinityV)\r\n   at System.Windows.Controls.Grid.MeasureCellsGroup(Int32 cellsHead, Size referenceSize, Boolean ignoreDesiredSizeU, Boolean forceInfinityV)\r\n   at System.Windows.Controls.Grid.MeasureOverride(Size constraint)\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at System.Windows.Controls.Grid.MeasureOverride(Size constraint)\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at System.Windows.Controls.Control.MeasureOverride(Size constraint)\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at System.Windows.Controls.VirtualizingStackPanel.MeasureOverride(Size constraint)\r\n   at Microsoft.Windows.Controls.Primitives.DataGridRowsPresenter.MeasureOverride(Size constraint) in D:\\dd\\WPF_TSV_2\\src\\wpf\\src\\ControlsPack\\WPFToolkit\\DataGrid\\Microsoft\\Windows\\Controls\\Primitives\\DataGridRowsPresenter.cs:line 118\r\n   at System.Windows.FrameworkElement.MeasureCore(Size availableSize)\r\n   at System.Windows.UIElement.Measure(Size availableSize)\r\n   at System.Windows.ContextLayoutManager.UpdateLayout()\r\n   at System.Windows.ContextLayoutManager.UpdateLayoutCallback(Object arg)\r\n   at System.Windows.Media.MediaContext.InvokeOnRenderCallback.DoWork()\r\n   at System.Windows.Media.MediaContext.FireInvokeOnRenderCallbacks()\r\n   at System.Windows.Media.MediaContext.RenderMessageHandlerCore(Object resizedCompositionTarget)\r\n   at System.Windows.Media.MediaContext.RenderMessageHandler(Object resizedCompositionTarget)\r\n   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Boolean isSingleParameter)\r\n   at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)\r\n   at System.Windows.Threading.Dispatcher.WrappedInvoke(Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)\r\n   at System.Windows.Threading.DispatcherOperation.InvokeImpl()\r\n   at System.Windows.Threading.DispatcherOperation.InvokeInSecurityContext(Object state)\r\n   at System.Threading.ExecutionContext.runTryCode(Object userData)\r\n   at System.Runtime.CompilerServices.RuntimeHelpers.ExecuteCodeWithGuaranteedCleanup(TryCode code, CleanupCode backoutCode, Object userData)\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Windows.Threading.DispatcherOperation.Invoke()\r\n   at System.Windows.Threading.Dispatcher.ProcessQueue()\r\n   at System.Windows.Threading.Dispatcher.WndProcHook(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)\r\n   at MS.Win32.HwndWrapper.WndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam, Boolean& handled)\r\n   at MS.Win32.HwndSubclass.DispatcherCallbackOperation(Object o)\r\n   at System.Windows.Threading.ExceptionWrapper.InternalRealCall(Delegate callback, Object args, Boolean isSingleParameter)\r\n   at System.Windows.Threading.ExceptionWrapper.TryCatchWhen(Object source, Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)\r\n   at System.Windows.Threading.Dispatcher.WrappedInvoke(Delegate callback, Object args, Boolean isSingleParameter, Delegate catchHandler)\r\n   at System.Windows.Threading.Dispatcher.InvokeImpl(DispatcherPriority priority, TimeSpan timeout, Delegate method, Object args, Boolean isSingleParameter)\r\n   at System.Windows.Threading.Dispatcher.Invoke(DispatcherPriority priority, Delegate method, Object arg)\r\n   at MS.Win32.HwndSubclass.SubclassWndProc(IntPtr hwnd, Int32 msg, IntPtr wParam, IntPtr lParam)\r\n   at MS.Win32.UnsafeNativeMethods.DispatchMessage(MSG& msg)\r\n   at System.Windows.Threading.Dispatcher.PushFrameImpl(DispatcherFrame frame)\r\n   at System.Windows.Threading.Dispatcher.PushFrame(DispatcherFrame frame)\r\n   at System.Windows.Window.ShowHelper(Object booleanBox)\r\n   at System.Windows.Window.Show()\r\n   at System.Windows.Window.ShowDialog()",
      "PostedDate": "2009-04-29T08:57:00.13-07:00",
      "Id": -2147483648
    },
    {
      "Message": "",
      "PostedDate": "2013-02-21T18:41:18.4-08:00",
      "Id": -2147483648
    }
  ]
}